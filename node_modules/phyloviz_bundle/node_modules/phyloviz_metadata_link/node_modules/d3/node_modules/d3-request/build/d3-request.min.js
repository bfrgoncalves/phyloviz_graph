!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-collection"),require("d3-dispatch"),require("d3-dsv")):"function"==typeof define&&define.amd?define("d3-request",["exports","d3-collection","d3-dispatch","d3-dsv"],n):n(e.d3_request={},e.d3_collection,e.d3_dispatch,e.d3_dsv)}(this,function(e,n,t,r){"use strict";function o(e,r){function o(){var e,n=f.status;if(!n&&s(f)||n>=200&&300>n||304===n){if(l)try{e=l.call(i,f)}catch(t){return void p.error.call(i,t)}else e=f;p.load.call(i,e)}else p.error.call(i,f)}var i,a,l,c,p=t.dispatch("beforesend","progress","load","error"),d=n.map(),f=new XMLHttpRequest,m=0;return"undefined"==typeof XDomainRequest||"withCredentials"in f||!/^(http(s)?:)?\/\//.test(e)||(f=new XDomainRequest),"onload"in f?f.onload=f.onerror=f.ontimeout=o:f.onreadystatechange=function(){f.readyState>3&&o()},f.onprogress=function(e){p.progress.call(i,e)},i={header:function(e,n){return e=(e+"").toLowerCase(),arguments.length<2?d.get(e):(null==n?d.remove(e):d.set(e,n+""),i)},mimeType:function(e){return arguments.length?(a=null==e?null:e+"",i):a},responseType:function(e){return arguments.length?(c=e,i):c},timeout:function(e){return arguments.length?(m=+e,i):m},response:function(e){return l=e,i},get:function(e,n){return i.send("GET",e,n)},post:function(e,n){return i.send("POST",e,n)},send:function(n,t,r){return r||"function"!=typeof t||(r=t,t=null),r&&1===r.length&&(r=u(r)),f.open(n,e,!0),null==a||d.has("accept")||d.set("accept",a+",*/*"),f.setRequestHeader&&d.each(function(e,n){f.setRequestHeader(n,e)}),null!=a&&f.overrideMimeType&&f.overrideMimeType(a),null!=c&&(f.responseType=c),m>0&&(f.timeout=m),r&&i.on("error",r).on("load",function(e){r(null,e)}),p.beforesend.call(i,f),f.send(null==t?null:t),i},abort:function(){return f.abort(),i},on:function(){var e=p.on.apply(p,arguments);return e===p?i:e}},r?i.get(r):i}function u(e){return function(n,t){e(null==n?t:null)}}function s(e){var n=e.responseType;return n&&"text"!==n?e.response:e.responseText}function i(e,n){return function(t,r){var u=o(t).mimeType(e).response(n);return r?u.get(r):u}}function a(e,n){return function(t,r,u){arguments.length<3&&(u=r,r=null);var s=o(t).mimeType(e);return s.row=function(e){return arguments.length?s.response(l(n,r=e)):r},s.row(r),u?s.get(u):s}}function l(e,n){return function(t){return e.parse(t.responseText,n)}}var c=i("text/html",function(e){return document.createRange().createContextualFragment(e.responseText)}),p=i("application/json",function(e){return JSON.parse(e.responseText)}),d=i("text/plain",function(e){return e.responseText}),f=i("application/xml",function(e){var n=e.responseXML;if(!n)throw new Error("parse error");return n}),m=a("text/csv",r.csv),g=a("text/tab-separated-values",r.tsv),v="0.3.0";e.version=v,e.request=o,e.requestHtml=c,e.requestJson=p,e.requestText=d,e.requestXml=f,e.requestCsv=m,e.requestTsv=g});